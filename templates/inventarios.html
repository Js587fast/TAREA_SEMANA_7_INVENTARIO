{% extends "base.html" %}
{% block title %}Inventario{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h4 mb-0"><i class="bi bi-clipboard-check"></i> Inventario</h1>

  <div class="d-flex gap-2">
    <!-- Botón Volver -->
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">
      <i class="bi bi-arrow-left-circle"></i> Volver al Menú Principal
    </a>

    <!-- Botón Descargar -->
    <div class="dropdown">
      <button class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
        <i class="bi bi-download"></i> Descargar Inventario
      </button>
      <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="{{ url_for('reportes.reporte_inventario') }}?formato=excel">
          <i class="bi bi-file-earmark-excel"></i> Excel</a></li>
        <li><a class="dropdown-item" href="{{ url_for('reportes.reporte_inventario') }}?formato=pdf">
          <i class="bi bi-file-earmark-pdf"></i> PDF</a></li>
      </ul>
    </div>

    <!-- Botón Nuevo -->
    {% if session.get('rol') == 'administrador' %}
    <a href="{{ url_for('inventario.nuevo_inventario') }}" class="btn btn-success">
      <i class="bi bi-plus-circle"></i> Nuevo registro
    </a>
    {% endif %}
  </div>
</div>

<div class="card shadow-sm p-3">
  <div class="table-responsive">
    <table id="tabla-inventario" class="table table-striped table-hover align-middle">
      <thead class="table-primary text-center">
        <tr>
          <th>ID</th>
          <th>Producto</th>
          <th>Tienda</th>
          <th>Cantidad</th>
          {% if session.get('rol') == 'administrador' %}<th>Acciones</th>{% endif %}
        </tr>
      </thead>
      <tbody>
        {% for inv in inventarios %}
        <tr class="text-center">
          <td>{{ inv.ID }}</td>
          <td>{{ inv.Producto }}</td>
          <td>{{ inv.Tienda }}</td>
          <td class="{% if inv.Cantidad < 10 %}text-danger fw-bold{% endif %}">
            {{ inv.Cantidad }}
          </td>
          {% if session.get('rol') == 'administrador' %}
          <td>
            <a href="{{ url_for('inventario.editar_inventario', id_inventario=inv.ID) }}" class="btn btn-sm btn-primary">
              <i class="bi bi-pencil-square"></i> Editar
            </a>
            <form action="{{ url_for('inventario.eliminar_inventario', id_inventario=inv.ID) }}" method="post" style="display:inline;">
              <button class="btn btn-sm btn-danger" onclick="return confirm('¿Eliminar este registro?')">
                <i class="bi bi-trash"></i> Eliminar
              </button>
            </form>
          </td>
          {% endif %}
        </tr>
        {% else %}
        <tr><td colspan="5" class="text-center text-muted">Sin registros</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Agregar DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  $(document).ready(function() {
    $('#tabla-inventario').DataTable({
      "pageLength": 5,
      "language": {
        "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
      }
    });
  });
</script>
{% endblock %}
